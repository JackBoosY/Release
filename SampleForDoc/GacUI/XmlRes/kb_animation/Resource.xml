<?xml version="1.0" encoding="utf-8"?>
<Resource>
  <Folder name="GacGenConfig">
    <Folder name="ResX86">
      <Text name="Resource">..\..\UIRes\32bits\kb_animation.bin</Text>
    </Folder>
    <Folder name="ResX64">
      <Text name="Resource">..\..\UIRes\64bits\kb_animation.bin</Text>
    </Folder>
  </Folder>
  <Folder name="MainWindow">
    <Script name="SharedScript">
      <Workflow>
        <![CDATA[
          module sharedscript;

          using system::*;
          using presentation::*;

          namespace sample
          {
            class RadioButtonTemplateState
            {
              prop Length : double = 0 {}
              prop Text : Color = {} {}
              prop Border : Color = {} {}
              prop Background : Color = {} {}

              new ()
              {
              }

              new (length: double, text: Color, border: Color, background: Color)
              {
                Length = length;
                Text = text;
                Border = border;
                Background = background;
              }

              static func Normal(): RadioButtonTemplateState^
              {
                return new RadioButtonTemplateState^(
                  0,
                  cast Color "#FFFFFF",
                  cast Color "#00FF00",
                  cast Color "#00000000"
                  );
              }

              static func NormalSelected(): RadioButtonTemplateState^
              {
                return new RadioButtonTemplateState^(
                  1,
                  cast Color "#000000",
                  cast Color "#00FF00",
                  cast Color "#00FF00"
                  );
              }

              static func Active(): RadioButtonTemplateState^
              {
                return new RadioButtonTemplateState^(
                  1,
                  cast Color "#FFFFFF",
                  cast Color "#FFFF00",
                  cast Color "#00000000"
                  );
              }

              static func ActiveSelected(): RadioButtonTemplateState^
              {
                return new RadioButtonTemplateState^(
                  1,
                  cast Color "#000000",
                  cast Color "#FFFF00",
                  cast Color "#FFFF00"
                  );
              }

              static func Pressed(): RadioButtonTemplateState^
              {
                return new RadioButtonTemplateState^(
                  1,
                  cast Color "#FFFFFF",
                  cast Color "#00FF00",
                  cast Color "#00000000"
                  );
              }

              static func PressedSelected(): RadioButtonTemplateState^
              {
                return new RadioButtonTemplateState^(
                  1,
                  cast Color "#000000",
                  cast Color "#FFFF00",
                  cast Color "#FFFF00"
                  );
              }
            }
          }
        ]]>
      </Workflow>
    </Script>

    <Animation name="RadioButtonTemplateAnimation">
      <Gradient ref.Class="sample::RadioButtonTemplateAnimation" Type="sample::RadioButtonTemplateState">
        <Interpolation><![CDATA[
          func (x: double): double
          {
            var d = 0.1;
            if (x < d) { return 0; }
            if (x > (1 - d)) { return 0; }
            var y = (x - d * 2) * (1 / (1 - d * 2));
            if (y < 0.5) { return y * yx * 2; } else { return 0.5 + (y - 0.5) * (y - 0.5) * 2; }
          }
        ]]></Interpolation>
        <Targets>
          <Target Name="Length"/>
          <Target Name="Text"/>
          <Target Name="Border"/>
          <Target Name="Background"/>
        </Targets>
      </Gradient>
    </Animation>

    <Instance name="RadioButtonTemplateResource">
      <Instance ref.Class="sample::RadioButtonTemplate">
        <ref.Members><![CDATA[
          var animationBuilder : RadioButtonTemplateAnimation^ = new RadioButtonTemplateAnimation^(RadioButtonTemplateState::Normal());
          var lastAnimation : IGuiAnimation^ = null;

          func OnStateChanged(): void
          {
            var newAnimation : IGuiAnimation^ = null;
            if (self.Selected)
            {
              switch (self.State)
              {
                case Normal:
                {
                  newAnimation = animationBuilder.CreateAnimation(RadioButtonTemplateState::NormalSelected(), cast UInt64 500);
                }
                case Active:
                {
                  newAnimation = animationBuilder.CreateAnimation(RadioButtonTemplateState::ActiveSelected(), cast UInt64 500);
                }
                case Pressed:
                {
                  newAnimation = animationBuilder.CreateAnimation(RadioButtonTemplateState::PressedSelected(), cast UInt64 500);
                }
              }
            }
            else
            {
              switch (self.State)
              {
                case Normal:
                {
                  newAnimation = animationBuilder.CreateAnimation(RadioButtonTemplateState::Normal(), cast UInt64 500);
                }
                case Active:
                {
                  newAnimation = animationBuilder.CreateAnimation(RadioButtonTemplateState::Active(), cast UInt64 500);
                }
                case Pressed:
                {
                  newAnimation = animationBuilder.CreateAnimation(RadioButtonTemplateState::Pressed(), cast UInt64 500);
                }
              }
            }
            
            KillAnimation(lastAnimation);
            lastAnimation = newAnimation;
            AddAnimation(lastAnimation);
          }

          func GetAlignment(): presentation::Margin
          {
            return {
              left:0
              top:0
              bottom:0
              right:(
                cast int Math::Round(
                  (1 - self.animationBuilder.Current.Length) * (self.boundary.Bounds.x2 - self.boundary.Bounds.x1 - 10)
                )
              )
            };
          }
        ]]></ref.Members>
        <SelectableButtonTemplate ref.Name="self" ContainerComposition-ref="container" MinSizeLimitation="LimitToElementAndChildren">
          <Bounds ref.Name="boundary" AlignmentToParent="left:0 top:0 right:0 bottom:0">
            <Bounds AlignmentToParent-bind="self.observe as _ (_.GetAlignment() on _.boundary.BoundsChanged, _.animationBuilder.Current.LengthChanged)">
              <SolidBorder Color-bind="self.animationBuilder.Current.Border" Shape="shapeType:RoundRect radiusX:5 radiusY:5"/>
            </Bounds>
            <Bounds AlignmentToParent-bind="self.observe as _ (_.GetAlignment() on _.boundary.BoundsChanged, _.animationBuilder.Current.LengthChanged)">
              <SolidBackground Color-bind="self.animationBuilder.Current.Background" Shape="shapeType:RoundRect radiusX:5 radiusY:5"/>
            </Bounds>
          </Bounds>

          <Table AlignmentToParent="left:0 top:0 right:0 bottom:0" MinSizeLimitation="LimitToElementAndChildren">
            <att.Rows>
              <CellOption>composeType:Absolute absolute:10</CellOption>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
              <CellOption>composeType:MinSize</CellOption>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
              <CellOption>composeType:Absolute absolute:10</CellOption>
            </att.Rows>
            <att.Columns>
              <CellOption>composeType:Absolute absolute:5</CellOption>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
              <CellOption>composeType:MinSize</CellOption>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
              <CellOption>composeType:Absolute absolute:5</CellOption>
            </att.Columns>

            <Cell Site="row:2 column:2">
              <Bounds AlignmentToParent="left:0 top:0 right:0 bottom:0" MinSizeLimitation="LimitToElementAndChildren">
              </Bounds>
              <Bounds AlignmentToParent="left:1 top:1 right:1 bottom:1" MinSizeLimitation="LimitToElementAndChildren">
                <SolidLabel Text-bind="self.Text" Font-bind="self.Font" Color-bind="self.animationBuilder.Current.Text"/>
              </Bounds>
              <Bounds ref.Name="container" AlignmentToParent="left:1 top:1 right:1 bottom:1" MinSizeLimitation="LimitToElementAndChildren"/>
            </Cell>
          </Table>

          <ev.StateChanged-eval><![CDATA[
            self.OnStateChanged();
          ]]></ev.StateChanged-eval>
          
          <ev.SelectedChanged-eval><![CDATA[
            self.OnStateChanged();
          ]]></ev.SelectedChanged-eval>
        </SelectableButtonTemplate>
      </Instance>
    </Instance>

    <InstanceStyle name="SharedStyle">
      <Styles>
        <Style ref.Path="//Cell/RadioButton" GroupController-ref="groupDirection">
          <att.ControlTemplate>sample::RadioButtonTemplate</att.ControlTemplate>
          <att.BoundsComposition-set PreferredMinSize="x:160"/>
        </Style>
      </Styles>
    </InstanceStyle>

    <Instance name="MainWindowResource">
      <Instance ref.Class="sample::MainWindow" ref.Styles="res://MainWindow/SharedStyle" xmlns:x="presentation::controls::GuiSelectableButton::*">
        <Window Text="kb_animation" IconVisible="true" ClientSize="x:480 y:320">
          <x:MutexGroupController ref.Name="groupDirection"/>
          <att.BoundsComposition-set PreferredMinSize="x:480 y:320"/>
          <Table CellPadding="10" BorderVisible="true" AlignmentToParent="left:0 top:0 right:0 bottom:0" MinSizeLimitation="LimitToElementAndChildren">
            <att.Rows>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
              <CellOption>composeType:MinSize</CellOption>
              <CellOption>composeType:MinSize</CellOption>
              <CellOption>composeType:MinSize</CellOption>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
            </att.Rows>
            <att.Columns>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
              <CellOption>composeType:MinSize</CellOption>
              <CellOption>composeType:Percentage percentage:0.5</CellOption>
            </att.Columns>

            <Cell Site="row:1 column:1">
              <RadioButton Text="Option A"/>
            </Cell>
            <Cell Site="row:2 column:1">
              <RadioButton Text="Option B"/>
            </Cell>
            <Cell Site="row:3 column:1">
              <RadioButton Text="Option C"/>
            </Cell>
          </Table>
        </Window>
      </Instance>
    </Instance>
  </Folder>
</Resource>